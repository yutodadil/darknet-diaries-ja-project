[イントロミュージック]
ジャック: イランのある男性がメールを確認しようとしています。彼はブラウザに「gmail.com」と入力し、エンターキーを押しました、すると奇妙な警告が表示されます。
「サーバー証明書が無効です」と書かれてした。
彼はGmailにアクセスできません、そこでVPNに接続して再試行します。
VPN経由では問題なく接続できます。
彼は何か怪しいことが起きているのではないかと考え、Googleのフォーラムにmitm攻撃が行われている可能性について質問を投稿します。
また、彼のISPやイラン政府が何か怪しいことをしているのではないかと疑っていると述べています。Googleはフォーラムの投稿に対してだけでなく、世界に向けてセキュリティ警告を発表し、Chromeブラウザに緊急のパッチをリリースしました。Mozilla、Microsoft、Appleも急いで同様のセキュリティアップデートを行いました。実際にGmailユーザーに対するmitm攻撃がありました、この攻撃はすべてのブラウザのセキュリティを脅かし、甚大な影響をもたらす攻撃でした。
ジャック（イントロ）: これは「Darknet Diaries」、インターネットの暗黒面からの実話をお届けします。私はジャック・リーサイダーです。
ジャック: Firefoxのようなウェブブラウザには、信頼できるCAの内部リストと、検証に使用するルート証明書のリストが含まれています。
ウェブサイトを訪れると、そのドメインを特定する証明書が提示されます。
この証明書には、どのCAがこの情報を確認したかも記載されています。
ブラウザはそのCAが信頼できるかどうかをチェックします。
あなたのブラウザには、すべての信頼できるCAとルート証明書のリストが含まれています。
例えば、Firefoxには…
ジャーベイズ: 64の組織と159の証明書があります。
ジャック: この信頼できる組織のリストをルートストアと呼びます。
企業が証明書機関になりたいと決めた場合、ブラウザと協力してルートストアに追加される必要があります。
もし追加されなければ、ブラウザはそのウェブサイトを信頼しません。
ジャーベイズ: 主要なルートストアは4つあります。
我々（Mozilla）、Microsoft、Apple、そしてGoogleです。
私たちがCAを含めるための基準には、CAが関連するセキュリティガイドラインに従って運営していることを示す特定の監査が含まれます。
監査人はそれを確認し、それらの監査をさまざまなルートプログラムに提示できるようにします。
ジャック: ジャーベイズとそのチームは、どのCAが信頼できるか、どのCAが信頼できないかを決定する責任を負っています。これは非常に重要な仕事です。彼は、インターネットのセキュリティガードのような存在で、Firefoxを使用するすべての人を見守り、信頼リストに載っている組織が世界にとって安全であることを確認しています。こう考えてみてください。もしあなたがFirefoxを使っているなら、あなたはジャーベイズ・マーカムという人物が、どの組織を信頼できるかを見極める能力を信頼しているということです。
ジャーベイズ: 私だけではありません。現在では3人がCAプログラムに取り組んでいますが、Mozillaは唯一、完全にオープンで透明なルートプログラムを運営しています。
ジャック: ジャーベイズとそのチームは、どのCAが信頼できるか、どのCAが信頼できないかを決定する責任を負っています。
これは非常に重要な仕事です。
彼は、インターネットのセキュリティガードのような存在で、Firefoxを使用するすべての人を見守り、信頼リストに載っている組織が世界にとって安全であることを確認しています。
こう考えてみてください。もしあなたがFirefoxを使っているなら、あなたはジャーベイズ・マーカムという人物が、
どの組織を信頼できるかを見極める能力を信頼しているということです。
ジャーベイズ: 私だけではありません。
現在では3人がCAプログラムに取り組んでいますが、Mozillaは唯一、完全にオープンで透明なルートプログラムを運営しています。
ジャック: ジャーベイズは、このような意思決定は一般に公開されるべきで、意思決定のプロセスを人々が見ることができ、さらには意思決定を助けるための意見を表明できるべきだと考えています。
これが彼の言う「オープンで透明な」ルートプログラムの意味です。
想像できるように、どの証明書機関が信頼できるかを決定するのは難しい作業だからです。
ジャーベイズ: 信頼は有機的なもので、チェックリストの終わりまで達成した結果として得られるものではありません。
例えば、カザフスタン政府が自国民全員をmitm攻撃しようとしているというニュース記事を読んだとしましょう。
そして、カザフスタン政府からブラウザに彼らのルート証明書を追加するよう申請が来たとしても、書類がすべて揃っていたとしても、そのルート証明書をブラウザに追加することに若干のためらいを感じるかもしれません。
その政府がその証明書をどのように使おうとしているのかに関する外部情報があるからです。
また、申請する組織の評判についての問題もあります。
単なるチェックリストではありませんが、少なくとも曖昧であっても客観的な基準を持ち、CAが含まれるために何をする必要があるかを知ることができるようにしています。
ジャック: しかし、ルートストアと証明書機関を使用するこのアプローチにはいくつかの問題があります。セキュリティ研究者たちはこの問題に対するより良い解決策を見つけようとしています。
一つの問題は...
ジャーベイズ: 証明書システムには、一番弱いリンクの問題があります。
つまり、64の異なる組織を信頼して、そのうちの1つがセキュリティ的に脆弱であれば問題があります。
あなたの特定のサイトが他の63のうちのどれかを使用していたとしても、攻撃者はセキュリティが不十分な組織から証明書を取得し、あなたになりすますことができてしまいます
ジャック: つまり、64の組織のうち1つでもハッキングされると、他のすべてのCAに対する信頼が損なわれてしまいます。基本的に、そのハッカーが信頼リストに載ることになるのです。
CAのセキュリティは最高水準で、侵入不可能でなければなりません。
Comodoは世界最大のCAの1つであり、世界中の数百万のウェブサイトに証明書を発行していますが、2011年初頭にハッキングされました。[音楽] 
ハッカーは9つの偽の証明書を発行しましたが、Comodoはすぐにこれを検知してその証明書を無効化しました。
数日後、Comodoは問題を修正し、侵入があったことを公表しましたが、その数日後に再度侵入が試みられました。
しかし、今回はハッカーは成功しませんでした。すべての試みは失敗しました。[音楽終了] 
ハッカーはネットワークに侵入することはできましたが、それ以上のことはできませんでした。
証明書を発行したり、その他の重要なことを行うことはできませんでした。
その後、Pastebinというウェブサイトに奇妙な投稿が現れました。
Pastebinは誰でも匿名でメッセージを投稿できるサイトです。
このメッセージは「Comodo Hacker」と名乗る人物によって書かれており、内容は次のようなものです。
「こんにちは。世界の皆さんに私たちのことをもっと知ってもらうためにこれを書いていますが、まず最初にいくつかの点を挙げて、自分がハッカーであることを証明したいと思います。私はインスタントSSLからComodoをハッキングしました。彼らのComodoのユーザー名とパスワードはGT adminとglobal trustです。私はグループではなく、1000人のハッカーの経験を持つ一人のハッカーです。」
メッセージはさらに、どのように侵入し何をしたかについて詳しく説明しています。最後にペルシャ語で「私はリーダーのために魂を捧げます」と書かれています。
5日後、Comodoは2回目の侵入を発表しましたが、ハッカーは何もできなかったと述べ、ネットワークの脆弱性を修正したとしています。
全体として、Comodoはこの問題に対処するのがかなりうまくいきました。
問題を迅速に検出し修正して、公に通知しました。
Comodoが唯一のCAではありません、もう1つの有名なCAはDigiNotarです。
DigiNotarはオランダを拠点とする会社で、1998年にオランダで公証を行うことから始まりました。
最終的に彼らは尊敬されるCAとなりました。実際、オランダ政府はDigiNotarを多くのウェブサイトのCAとして使用していました。
2011年初頭、VASCOはDigiNotarを約1300万ドルで買収しました。
ジョセフィン: DigiNotarは本当にセキュリティに多大な投資をしていたケースだと思います。
証明書機関として当然そうしなければならないのです。
ジャック: これがジョセフィン・ウルフです。
ジョセフィン: 私はロチェスター工科大学の公共政策およびコンピューティングセキュリティ学科の助教授です。
ジャック: 彼女は最近、DigiNotarに関連する記事と論文をSlateに発表しました。
ジョセフィン: ネットワークは複数のセグメントで構成されており、外部に面した部分、外部ネット、そしてDNZ内部、さらにいくつかの層がその先にありますが、物理的なセキュリティも施されていました。
ネットワークの最も安全な部分に入った後、証明書を発行するために使用されるプロダクションサーバーにアクセスするためには、コンピューターが置かれた部屋に入る必要があり。
そこはまるでジェームズ・ボンドの映画に出てくるような場所です。
二重のドアがあり、手の認証装置とピンコードがあり、電子キーを挿入することで初めて証明書発行のプロセスが始まります。
このセットアップでは、証明書を発行するために複数のレベルのセキュリティを通過しなければなりません。
ジャック: DigiNotarは、セキュリティが会社の評判にとって重要であることを理解しており、自社のセキュリティに多大な投資をしていました。
私は時々、ネットワークのセキュリティを、1万個のドアと窓を持つ城のセキュリティと似ていると考えています。
すべてのドアと窓をチェックしてロックされていることを確認する時間を費やしたとしても、1つ見逃したり、気づかなかったりする可能性があり、時間が経つにつれて、ミスをしてドアを開けたままにしてしまうこともあるでしょう。
怠惰や注意散漫が原因かもしれませんが、人間はミスをします。2011年の夏、DigiNotarはそのようなミスを犯し、ハッカーが彼らのネットワークに侵入しました。
ジョセフィン: [音楽] この侵入は、実行者がDigiNotarの公開ウェブサーバーに接続することから始まりました。
それは少し古く、コンテンツ管理ソフトウェアのパッチが更新されていませんでした。
実行者はこれらのウェブサーバーに接続し、その古くなった脆弱性を利用して、非常に厳重なファイアウォールルールを通過し、本来最も安全とされるネットワークのサイロに侵入します。
ジャック: ハッカーは最終的に証明書を発行するサーバーにたどり着きましたが、DigiNotarにはセキュリティチェックが実装されており、証明書を発行する前にコンピュータに物理的なキーを挿入する必要がありました。
ジョセフィン: 実際にはキーが常に差し込まれていたようです。それは単に怠惰のためではなく、DigiNotarが自動で証明書失効リストを生成したいからだと思われます。
証明書が信頼できなくなったり、期限が切れたり、何らかの理由で失効されたりするたびに、DigiNotarはそれらの証明書のリストを自動で発行し、DigiNotarの証明書を信頼しているすべてのブラウザがその特定の証明書を信頼しないようにしたいのです。
これらのリストを発行するには、この部屋の安全なサーバーの1つにこれらのカードを差し込んでおく必要があります。
そのため、そのカードが常に差し込まれていることにより、一見過剰に見えるこれらのセキュリティ層がすべて回避できることになりました。
侵入者は、さまざまな異なるドメインの名で一連の不正な証明書を発行することができました。
特に大きな問題となったのはGoogle.comの証明書ですが、cia.govの証明書も発行され、多くの他の証明書も含まれていたとされています。
ジャック: これらの証明書を手にしたハッカーは、今やGoogleになりすますことができます。彼らはブラウザをだまして、自分たちがgoogle.comであると信じ込ませることができます。
なぜなら、DigiNotarはブラウザ内で信頼されていたCAの1つだからです。
この侵入は2011年7月10日に発生し、最終的に531の不正な証明書が発行されました、9日後、DigiNotarは侵入を検知しましたが、公には発表しませんでした。
1か月以上後、イランの男性がgmail.comにアクセスできないというGoogleフォーラム投稿が現れました。
ジョセフィン: Gmailアカウントに接続しようとしているイランの人々は、おそらく本物のGmailと全く同じように見える偽のウェブサイトにリダイレクトされていたのです。
DigiNotarによって発行された不正な証明書があるため、この偽のGmailまたはGoogleのウェブサイトを作成した人々は、それを実際にサインし、本当にGoogleのサイトであるかのように見せかけることができました。
しかし、これらの不正な証明書があるため、人々は信じているGoogleのサイトにアクセスし、認証情報を入力していたのです。その認証情報が、彼らのGoogleアカウントをさまざまな方法でスパイするために使用されていると推測されます。
ジャック: 次にハッカーはこれらの証明書を使用して、mitm攻撃を開始しました。これは、ハッカーが本来別の場所へ行くはずのトラフィックを傍受する方法です。
不正な証明書は、mitm攻撃を行うために必要なものの半分にすぎません、ハッカーは人々を本物のGoogleサーバーではなく、自分のサーバーにリダイレクトする必要があります。
どのように行ったかは正確にはわかりませんが、最も有力な仮説で最も多くの証拠を持つ理論は、彼がDNSポイズニング攻撃を行ったというものです。
DNSサーバーは、google.comのようなドメインをIPアドレスに翻訳し、ルーターがどこに行く必要があるかを見つけられるようにします。
彼はイランのDNSサーバーをだまして、google.comを探している誰もが自分のIPにリダイレクトされるようにしました。
ジョセフィン: リダイレクトがどのように行われたかについての決定的な証拠はありません。
状況証拠を用いて、その事例を立証しようとすることはできます。イランのISPが共謀している、または脅迫されているために、不正なサイトにトラフィックをリダイレクトしている可能性があります。
もう1つの可能性は、非常に高レベルのDNSサーバーが侵害され、それに依存する他のDNSサーバーに偽のレコードが伝播されているというものです。
しかし、調査者が感じているのは、それはおそらくそうではないということです。
なぜなら、人々がどれだけリダイレクトされているか、いつリダイレクトされているかを調べてみると、それがとても突発的であるからです。
つまり、多くの人が偽のサイトにアクセスしている時期に急激なスパイクがあり、その後減少し、またスパイクがあるということで、高レベルでのDNSポイズニングとは思えません。
おそらく、一部のローカルDNSサーバーが高レベルの信頼されたDNSサーバーから来るかのように見えるメッセージで氾濫しており、実際には攻撃者からのもので、
「これがgoogle.comの正しい最新のDNSレコードです」と言っています。
しかし、それは一定期間しか持続しません。なぜなら、そのDNSサーバーはより高いレベルのDNSサーバーから正しいレコードを取得し、再び正しいサイトに人々を送り始めるからです。
攻撃者は戻って再びそれをポイズニングしなければなりません。
ジャック: イランからの30万人以上が不正なサーバーを訪れました。この攻撃はイランの市民を標的にしているように見えました。
この攻撃はしばらくの間、検出されずに済むかもしれませんでしたが、Googleにはこれを検出する巧妙な方法がありました。
ジョセフィン: Googleが製造しているChromeブラウザ内でこれが行われているため、最終的に気付かれました。
Chromeブラウザはこれらの証明書をチェックしており、それを模倣するために使われるウェブサイトの所有者であるGoogleが発行元だからこそ気付けたのです。
つまり、これは信頼された証明書機関から来た証明書です。ChromeはDigiNotarによって発行された証明書を信頼しますが、私たちはそれが正しい証明書ではないと知っています。
なぜなら、自分たちのGoogle証明書を知っているからです。これはその一つではありませんでした。
ジャック: これが、Googleフォーラムの男性がサーバー証明書エラーを受けた理由です。Firefoxのジャーベイズは最前線にいました。
ジャーベイズ: Googleが通知してくれたのは、イランのユーザーに対する攻撃で使用されていた、正しく発行されていないgoogle.comの証明書を検出したということでした。
私たちはこの調査を開始しました。私は基本的にインスタントレスポンスを担当していたので、とても忙しかったです。
DigiNotarの場合、そのネットワークは数ヶ月にわたって徹底的に侵害されており、ログはかなり混乱していました。
インフラストラクチャも混乱していて、侵害の範囲を特定する方法がなく、特定のルートや中間グループに限定する方法もありませんでした。
セキュリティの壊滅的な失敗のために、DigiNotarのシステムおよび組織における信頼を続けることは不可能でした。
ジャック: MozillaがDigiNotarを信頼できなくなったと判断した時、彼らはDigiNotarをルートストアから削除しましたがユーザーはDigiNotarを信頼しないバージョンのFirefoxを受け取るためにブラウザを更新しなければなりませんでした。
他のすべてのルートストアもDigiNotarを信頼リストから削除しました。侵入が発生してから約2か月後、そしてイランが大規模なmitm攻撃の標的になった後になるまで、DigiNotarはついに自分たちが侵害されたことを公に認めました。
ジョセフィン: この侵害が公に認められるとすぐに、オランダ政府が介入し、DigiNotarを管理下に置きました。
これは民間企業の侵害の歴史の中では前例のないことです、それが起こったとき、その会社は大部分が蚊帳の外に置かれました。
彼らの指導部が調査官を雇うかどうかの決定やその他すべてのことを決める立場にはなくなりました。
ジャック: オランダ政府は、DigiNotarを多数の政府サイトやアプリケーションの主要なCAとして使用していました、ブラウザがDigiNotarを信頼されたルートストアから削除し始めると、オランダ政府の多くのシステムが壊れました。
彼らはルートストアに接触し、DigiNotarをルートストアに再追加するように求めました。
ブラウザはDigiNotarを信頼できるCAとして再追加しましたが、不正な証明書の問題を解決するために、ルートストアは2011年7月以降にDigiNotarが発行した証明書をブロックしました。
これにより、オランダ政府は新しいCAを見つけるための作業を続けることができました。最終的にオランダ政府は新たなCAに移行し、侵害から3か月以内にDigiNotarは恒久的に閉鎖されました。
ジャック: DigiNotarはFox-ITというセキュリティ会社を雇い、何が起こったのかを調査させました。
彼らはDigiNotarネットワークに多くの問題を見つけました。Windowsドメイン管理者アカウントは単純なパスワードが設定されており、ブルートフォース攻撃を受けやすい状態でした。
そして、すべての証明書発行サーバーが単一のドメイン上にありました。これは、1つの管理者アカウントですべての8台の証明書サーバーにアクセス可能だったことを意味します。
多くのシステムにはウイルス対策ソフトがインストールされておらず、一部の攻撃を防ぐことができませんでした。
中央のログ管理がなく、重要なシステムの分離も行われていませんでした。これらすべての失敗が組み合わさり、ハッカーがすべてのセキュリティチェックを回避することができたのです。
Fox-ITはまた、誰がこの攻撃を行ったのかを見つけるために証拠を調査しました。
ジョセフィン: 誰がこれを行ったのかは分かっていません。この侵入に関して捕まったり起訴されたりした人はいません。
ジャック: 実際のところ、誰がこれを行ったのかを特定することはできていませんが、Fox ITが侵入を調査した際にいくつかの興味深い手がかりを見つけました。
まず、ハッカーがネットワークで使用したすべてのIPを調べました。すべてのIPはプロキシに遡ることができましたが、1つを除いては。それはイランからDigiNotarネットワークに接続していたIPで、プロキシを経由していませんでした。
数秒間だけ接続してから切断され、その後新たなプロキシからの接続がありました。これはハッカーのミスだった可能性があり、彼はそれをすぐに修正したのかもしれません。
そのIPは以前にもDigiNotarを訪れていたことが確認されており、偵察目的だった可能性があります。Fox-ITはまた、ハッカーが侵入したサーバーにメッセージを残していたことも発見しました。
そのメッセージの一部は次のように書かれていました。
「この世界には私の激しい攻撃、私の脳、私の技術、私の意志、私の専門知識を止められるハードウェアもソフトウェアもありません」と結びには、「私はリーダーのために魂を捧げます」とペルシャ語で書かれていました。
さらに、Comodo CAをハッキングしたと主張していた人物から、新しいPastebinのメッセージが現れました。
このComodoハッカーは、DigiNotarにも侵入したことを認め、同じペルシャ語のメッセージでPastebinに署名しています。また、彼は21歳で単独で活動していることを述べています。
ジョセフィン: 確かにDigiNotarとオランダ政府は、これらすべての出来事の要因として非常に絡み合っていますが、実際の標的はイラン市民を狙ったスパイ活動でした。
ジャック: しかし、誰がイランの市民のメールを読みたいと思うでしょうか？ アメリカはイランと対立しており、疑わしいとされるかもしれません。
著名なセキュリティ専門家であるブルース・シュナイアーは、NSAの作戦か、NSAの脆弱性を利用したものかもしれないとしていますが、これは主にNSAがDigiNotarにアクセスしていたことを示すNSA文書のリークによるものです。
この理論は非常に弱く、他の証拠はほとんどありません。では、イランの一般市民を標的にしている他の可能性は？
イラン政府自身です。その理由を理解するために、このハッキングの2年前に遡る必要があります。
2009年、イランで大統領選挙が行われました。マフムード・アフマディネジャドは63％の票を獲得して選挙に勝利しましたが、これに強い反発がありました。
多くのイラン人が票が操作され、選挙が不正に行われたと信じていました。抗議活動がすぐに始まりました。
これによりイランの人々の間に分裂が生じ、一部の人々は政府に対して非常に不信感を抱くようになり、他の人々は非常に忠誠を誓うようになりました。
警察は抗議者を逮捕し始め、抗議者が退去しない場合には、ペッパースプレーを使ったり、警棒で叩いたり、時には発砲したりしました。
選挙から3か月以内に、72人の抗議者が死亡しました。腐敗は非常に深刻で、警察は家族に、死んだ親族が警察の残虐行為ではなく心臓発作で亡くなったと書かれた書類に署名させました。
ご想像の通り、これによりイランの人々の間でさらに感情が高まっただけでした。その後数年間、イラン政府は政府に対する反対意見を排除するために懸命に取り組みました。
これが続き、DigiNotar事件が発生したのです。このハッキングは、イラン政府自身、またはイラン政府を支援しようとする人物によって行われたという強力な理論があります。
彼らは、反対意見を持つ人々やイラン大統領に不満を持つ人々を見つけようとメールを調べていた可能性があります。もしそのような人が見つかった場合、逮捕されたり、拷問されたり、殺されたりする可能性があったかもしれません。
証明書機関とブラウザ開発者は、DigiNotarから多くの重要な教訓を学びました。ルートストアに受け入れられるために、CAが通過しなければならない監査はより厳しくなりました。
公開鍵ピンニングの利用も増えました。これはGoogleがこの侵害を検出するためにChromeブラウザで行ったことです。
具体的には、ChromeがGoogleのCAから発行された証明書のみを受け入れるようにし、証明書を特定のCAに固定しました。
DigiNotar以降、多くのウェブサイトがこれを行っていますが、欠点もあります。
たとえば、ウェブサイトが証明書をビジネスを終えたCAに固定してしまった場合、またはハッカーが不正なCAに証明書を固定した場合に、どのような問題が発生するかを想像してみてください。
証明書の固定を解除することは現在複雑な作業です。
DigiNotar以降、Firefoxは不正な証明書をブロックする新機能を追加しました。ここで、ジャーベイズにその話を聞いてみましょう。
ジャーベイズ: 「OneCRL」と呼ばれるシステムがあります。これがいわば緊急失効システムです。すべてのFirefoxは、このブラックリスト上の証明書を24時間ごとにチェックします。
個々の証明書を緊急失効させる必要がある場合、または事実上中間証明書に基づく証明書の全ツリーを緊急失効させる必要がある場合、それをOneCRLに追加できます。
このシステムを持つすべてのFirefoxは24時間以内にそれらの証明書を信頼しなくなります。我々が何かを不信するためにアップデートをインストールする必要はありません。 
[アウトロミュージックスタート]
ジャック: DigiNotarについて語ってくれたジョセフィン・ウルフおよび、このポッドキャストに登場してくれたジャーベイズ・マーカムに特大の感謝を捧げます。
なぜなら、このエピソードが初めて放送された約1年後に、ジャーベイズが亡くなったからです。
彼は22歳のときに悪性の唾液腺癌と診断され、18年間にわたる闘病の末、40歳で亡くなりました。ジャーベイズは、FirefoxとBugzillaツールのセキュリティ向上に多大な貢献をしました。
この危険な世界での私たちの安全を守るために尽力してくれた彼に感謝します。ジャーベイズ、あなたがいなくなって寂しくなります。音楽はイアン・アレックス・マックとケビン・マクロードによって提供されています。
[アウトロミュージックエンド]
